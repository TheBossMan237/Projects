<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {margin:0px; background-color: black;}
        #Settings {
            position: absolute;
            opacity: 30%;
            height : 30px;
            width : 100%;
            background-color: black;
            border  :1px solid black;
        }
        .Line {
            white-space: nowrap;
            overflow:visible;
            background-color: black;
            width : fit-content;
            height : 20px;
            font-family: monospace;
            font-size: 0px;
        }
        #Selected {
            border-top : 1px solid rgba(100, 100, 100, 1);
            border-bottom: 1px solid rgba(100, 100, 100, 1);
        }
        #Cursor {
            
            position: absolute;
            border-right : 1px solid white;
            width: 0px;
            left : 0em;
            height : 20px;
            font-size: 10px;
            font-family:monospace;
            padding : 0px;
            margin : 0px;
            background-color: transparent;
        }
        span {
            white-space:break-spaces;
            color : white;
            margin : 0px;
            font-size : 20px;
        }


    </style>
</head>
<body>
    <span style="font-family:monospace; font-size:20px; position:absolute; color:transparent" id="Width">1</span>
    <div class="Con" id="Codespace">
        <div id="Cursor"></div>
        <div class="Line" id="Active">
            <span></span>
            <span></span>
        </div>
        <span id="Output"></span>
        
    </div>
    <script>
        let Commands = {
            /**@type {HTMLSpanElement}*/ Output:undefined,
            Init:()=>{
                Commands.Output = document.getElementById("Output");
            },
            Output : document.getElementById("Output"),
            Run:(/**@type {String}*/Value)=>{
                let Str = "";
                let Command = ""
                if(Value == "cd") Command = "cd";
                if(Commands[Command] == undefined || typeof(Commands[Command]) != "function") {
                    return '"' + Command + '" ' + "is not recognized as a command"
                } else {
                    Commands.Output.innerText = Commands[Command]();
                }
            },
            cd:(Args)=>{
                return "111111111111111111\n\n\n"
            },
            
        }
        let Directory = {
            /**@type {String} */ dir:undefined,
            /**@type {Number} */ length:undefined,
            /**@type {Object}*/ self:undefined,

            Init:()=>{
                Directory.dir = "C:/>"
                Directory.loc = ["C:"]
                Directory.length = Directory.dir.length;
                Directory.self = {"C:":{"Folder1" : {"Main.txt" : "Contents"}, "Folder2" : {}}, "D:":{}};
            },
            CD:(/**@type {String}*/Path)=>{
                let t = Path.charAt(0) == "/" ? Directory.loc + Path : Path;
                let Current = Directory.self;
                t.split("/").forEach(function(val, ind) {
                    
                    console.log(Current, val);
                    if(Current === undefined) return -1;
                    Current = Current[val];
                })
                return Current;
            },
            NewDir(/**@type {String}*/ Path, FolderName) {
                if(Directory.CD(Path) == -1) return
                Directory.CD(Path)[FolderName] = {};
            }


        }
        let text = {
            /**@type {HTMLSpanElement}*/self : undefined,
            /**@type {HTMLDivElement}*/line : undefined,
            /**@type {Number}*/spacing : undefined,
            /**@type {HTMLSpanElement}*/Dir_elem : undefined,
            /**@type {Number} */ length:undefined,
            /**@type {HTMLDivElement}*/ Codespace:undefined,
            Init:()=>{
                text.spacing = document.getElementById("Width").clientWidth;
                text.line = document.getElementById("Active");
                text.Dir_elem = text.line.children.item(0);
                text.self = text.line.children.item(1);
                text.Dir_elem.innerText = Directory.dir;
                text.length = 0;
                text.Codespace = document.getElementById("Codespace")
            },
            Insert:(Char)=>{
                text.self.innerText = text.self.innerText.slice(0, Cursor.X) + Char + text.self.innerText.slice(Cursor.X)
                if(Cursor.X < text.self.innerText.length)Cursor.X++;
                text.length++;
            },
            Delete:()=>{
                if(text.self.innerText.length > 0 && Cursor.X > 0) {
                    text.self.innerText = text.self.innerText.slice(0, Cursor.X-1) + text.self.innerText.slice(Cursor.X);
                    if(Cursor.X > 0) Cursor.X--
                    text.length--;
                }
            },
            NewLine:() => {
                text.line.id = "";
                let e = document.createElement("div");
                e.append(document.createElement("span")); e.append(document.createElement("span"))
                e.id = "Active"; e.classList.add("Line")
                text.Codespace.append(e);

                e = document.getElementById("Output");
                text.Codespace.append(e.cloneNode())
                e.id = "";

                text.Init(); Cursor.Init(); Commands.Init();
            },
        }
        let Cursor = {
            /**@type {Number}*/ X:undefined,
            /**@type {Number}*/ Y:undefined,
            /**@type {HTMLDivElement}*/ self:undefined,

            Init:()=>{
                Cursor.X = 0;
                Cursor.Y = document.getElementById("Active").offsetTop;
                Cursor.self = document.getElementById("Cursor");
            },
            Update:()=>{
                Cursor.self.style.width = (Directory.length*text.spacing)+(Cursor.X*text.spacing) + "px";
                Cursor.self.style.top = Cursor.Y + "px";
            },
            SetX:(Val)=>{Cursor.X = Val;}
        }
        Directory.Init(); text.Init(); Cursor.Init(); Cursor.Update();
        document.onkeydown = function(ev) {
            if(ev.key.length == 1) {
                
                text.Insert(ev.key);
            } else {
                switch(ev.key) {
                    case "Backspace": text.Delete(); break;
                    case "ArrowLeft":  if(Cursor.X > 0) {Cursor.SetX(Cursor.X-1)} break;
                    case "ArrowRight": if(Cursor.X < text.length) {Cursor.SetX(Cursor.X+1)} break;
                    case "Tab": text.Insert("    "); Cursor.SetX(Cursor.X+3); break;
                    case "Enter": if(text.self.innerText != "") {Commands.Run(text.self.innerText); text.NewLine();} break;
                }
            }
            Cursor.Update();
            console.log(ev.key)
        }

        
        


    </script>
</body>
</html>
